/*
 * This build file was auto generated by running the Gradle 'init' task
 * by 'tom' at '9/14/16 9:09 PM' with Gradle 2.10
 */
// Import common tasks
apply from: "..${File.separator}automation-utilities${File.separator}build${File.separator}build.support.gradle"

// Define dependencies to copy over in the copyDependencies task
ext.dependencies = ["automation-utilities", "python_lifx_sdk"]

// Overwrite the build task in build.support
build {
   dependsOn copyDependencies
   dependsOn copySources
   dependsOn parseTemplates

   // Create a dependency tree of copySources->copyDependencies->parseTemplates
   copyDependencies.mustRunAfter copySources
   parseTemplates.mustRunAfter copyDependencies
}

// Runs an application that does not use Docker
runNativeApplication << {
	
	Properties props = loadProperties()
	
	exec {
		executable "${buildDir}${File.separator}venv${File.separator}bin${File.separator}gunicorn"
		workingDir "${buildDir}"
		args=["-b", "0.0.0.0:${props.applicationPort}", "app:app"]
	}
}

// Creates an application that does not use Docker
deployNativeApplication << {
	exec {
		executable 'virtualenv'
		args "${buildDir}${File.separator}venv"
	}
	exec {
		executable "${buildDir}${File.separator}venv${File.separator}bin${File.separator}pip"
		args=["install","-r","${buildDir}${File.separator}requirements.txt"]
		workingDir "${buildDir}"
	}
}
